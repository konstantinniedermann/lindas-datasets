<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>
    <script src="//cdn.rawgit.com/rdf2h/rdf2h/v0.3.0/dist/rdf-ext.js"></script>
    <script src="//cdn.rawgit.com/rdf2h/rdf2h/v0.3.0/dist/rdf2h.js"></script>
    <script src="//cdn.rawgit.com/retog/rdf-parser-n3-browser/v0.3.0b/dist/n3-parser.js"></script>
    <script src="//cdn.rawgit.com/retog/rdf-store-ldp-browser/v0.3.0-rc2f/dist/rdf-store-ldp.js"></script>
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="//cdn.rawgit.com/rdf2h/ld2h/v0.4.0/dist/ld2h.js"></script>
    <link rel="import" href="bower_components/moment-js/moment-js.html">
    <script id="matchers" type="text/turtle">
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    @prefix r2h: <http://rdf2h.github.io/2015/rdf2h#> .
    @base <http://data.admin.ch/> .
    @prefix void: <http://rdfs.org/ns/void#> .
    @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
    @prefix owl: <http://www.w3.org/2002/07/owl#> .
    @prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
    @prefix dcterms: <http://purl.org/dc/terms/> .
    @prefix foaf: <http://xmlns.com/foaf/0.1/> .
    @prefix wv: <http://vocab.org/waiver/terms/norms> .        
    @prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
    @prefix dcat: <http://www.w3.org/ns/dcat#> .
    @prefix schema: <http://schema.org/>.
    @prefix time: <http://www.w3.org/2006/time#>.
    
    [ a r2h:Matcher ;
      r2h:triplePattern [
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object void:DatasetDescription;
      ];
      r2h:template [
        r2h:context r2h:Default;
        r2h:mustache """
            <h1>{{dcterms:title}}</h1>
            <p>Created by: <span class="fetch" resource="{{dcterms:creator}}">creator</span></p>
            <h2>Datasets</h2>
            {{#foaf:topic}}
                <span class="fetch" resource="{{.}}">topic</span>
            {{/foaf:topic}}
        """
      ]
    ] r2h:before 
    [ a r2h:Matcher ;
      r2h:triplePattern [
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object foaf:Organization;
      ];
      r2h:template [
        r2h:context r2h:Default;
        r2h:mustache """
        <a href="{{foaf:homepage}}"><span class="languageAlternatives">
            {{#rdfs:label}}
            <span lang="{{./dcterms:language}}">{{.}}</span>
            {{/rdfs:label}}
        </span></a>
        """
      ]
    ].
    [ a r2h:Matcher ;
      r2h:triplePattern [
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object foaf:Person;
      ];
      r2h:template [
        r2h:context r2h:Default;
        r2h:mustache """
        <a href="{{{.}}}">{{foaf:givenName}} {{foaf:familyName}}</a>
        """
      ]
    ].
    [ a r2h:Matcher ;
      r2h:triplePattern [
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object void:Dataset;
      ];
      r2h:template [
        r2h:context r2h:Default;
        r2h:mustache """
        <h3>
        <a href="{{foaf:homepage}}">
        <span class="languageAlternatives">
            {{#dcterms:title}}
            <span lang="{{./dcterms:language}}">{{.}}</span>
            {{/dcterms:title}}
        </span>
        </a>
        </h3>
        <div class="languageAlternatives">
            {{#dcterms:description}}
            <span lang="{{./dcterms:language}}">{{.}}</span>
            {{/dcterms:description}}
        </div>
        <ul>
            {{#dcterms:publisher}}
                <li>Publisher: <span class="fetch" resource="{{.}}">publisher</span></li>
            {{/dcterms:publisher}}
            {{#dcterms:creator}}
                <li>Creator: <span class="fetch" resource="{{.}}">creator</span></li>
            {{/dcterms:creator}}
            {{#dcterms:contributor}}
                <li>Contributor: <span class="fetch" resource="{{.}}">contributor</span></li>
            {{/dcterms:contributor}}
            {{#dcterms:issued}}
                <li>Issued: <moment-js date="{{.}}" format="DD.MM.YYYY"></moment-js></li>
            {{/dcterms:issued}}
            <li>SPARQL Endpoint: <a href="void:sparqlEndpoint">{{void:sparqlEndpoint}}</a></li>
            {{#+void:exampleResource}}
                <li><b>Example resources</b>
                <ul>
                {{#void:exampleResource}}
                <li><a href="{{{.}}}">{{{.}}}</a></li>    
                {{/void:exampleResource}}
                </ul></li>    
            {{/+void:exampleResource}}
        </ul>
        """
      ]
    ].
    

        </script>
    <script type="text/javascript">
    function chooseBestLanguageAlternative(langPreferences) {
        $(".languageAlternatives").each(function(index, element) {
            $(element).children().hide();
            for (var i = 0; i <= langPreferences.length; i++) {
                console.log("looking for variant in: "+langPreferences[i]);
                var languageShown = false;
                $(element).children().each(function(index2, element2) {
                    var e = $(element2);
                    console.log("in child with lang "+e.attr("lang")+" looking for "+langPreferences[i]);
                    if ((i === langPreferences.length) || (langPreferences[i] === e.attr("lang").toLocaleLowerCase())) {
                        e.show();
                        languageShown = true;
                    }
                });
                if (languageShown) {
                    break;
                }
            }
        })
    }
    $(function () {
        LD2h.expand().then(function() {
            //waiting for https://github.com/rdf2h/ld2h/issues/6 to be fixed
            window.setTimeout(function() {
                var browserLanguage = window.navigator.userLanguage || window.navigator.language;
                chooseBestLanguageAlternative([browserLanguage,browserLanguage.split("-")[0],"en", "de", "fr", "it", "rm"]);
            }, 500);
        });
    });
</script>
</head>
<body>
 <div class="fetch" resource="http://data.admin.ch/">result will show up here</div>
</body>
</html>